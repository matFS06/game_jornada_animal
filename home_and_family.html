<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>üè† My Home & Family</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body {
    font-family: 'Comic Sans MS', cursive;
    background: linear-gradient(to bottom right,#d6f6ff,#ffe6f2);
    text-align:center;
    padding:20px;
  }

  .game-container {
    background:white;
    border-radius:20px;
    padding:25px;
    max-width:900px;
    margin:auto;
    box-shadow:0 4px 12px rgba(0,0,0,0.2);
    position:relative;
  }

  .header-box {
    display:flex;
    justify-content:space-between;
    font-weight:bold;
    font-size:20px;
    margin-bottom:10px;
  }

  .pair-container {
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    width:100%;
    gap:10px;
  }

  .words {
    width:48%;
    display:flex;
    flex-direction:column;
    align-items:flex-start;
  }

  .word-box {
    background:#fff0f6;
    border:3px solid #ffc1e3;
    padding:15px;
    margin-bottom:20px;
    border-radius:12px;
    cursor:pointer;
    font-weight:bold;

    height:100px;
    display:flex;
    justify-content:center;
    align-items:center;

    width:100%;
    max-width:360px;
    font-size:20px;

    word-wrap:break-word;
    overflow-wrap:break-word;
    text-align:center;
  }

  .images {
    width:45%;
    display:flex;
    flex-direction:column;
    align-items:flex-end;
  }

  .img-box {
    background:#fff0f6;
    border:3px solid #ffc1e3;
    margin-bottom:20px;
    border-radius:50%;
    cursor:pointer;
    width:120px;
    height:100px;
    display:flex;
    justify-content:center;
    align-items:center;
    padding:0;
  }

  .img-box img {
    width:100%;
    height:100%;
    border-radius:50%;
    object-fit:cover;
  }

  /* SVG responsivo */
  #lines-svg {
    position:absolute;
    top:0;
    left:0;
    pointer-events:none;
    width:100%;
    height:100%;
  }

  /* ===== MOBILE REAL ===== */
  @media (max-width:700px){
    .pair-container {
      flex-direction:column;
      align-items:center;
    }

    .words, .images {
      width:100%;
      align-items:center;
    }

    .word-box {
      width:85%;
      max-width:none;
      height:90px;
      font-size:18px;
    }

    .img-box {
      width:110px;
      height:110px;
    }

    .img-box img {
      width:100%;
      height:100%;
    }
  }

  @media (max-width:420px){
    .word-box {
      height:80px;
      font-size:16px;
    }

    .img-box {
      width:95px;
      height:95px;
    }
  }

</style>

</head>

<body>

<div class="game-container">
  <div class="header-box">
    <div id="questionNumber">Question 1/8</div>
    <div id="scoreBox">Score: 0</div>
  </div>

  <h2 id="levelTitle">üè† My Home & Family</h2>
  <p class="fw-bold">Match the words with the correct pictures.</p>

  <svg id="lines-svg" width="100%" height="100%"></svg>

  <div class="pair-container">
    <div id="words" class="words"></div>
    <div id="images" class="images"></div>
  </div>

  <div style="margin-top:10px;">
    <button id="checkBtn" class="btn btn-success" onclick="checkMatch()">Check ‚úîÔ∏è</button>
    <button id="nextBtn" class="btn btn-warning" onclick="nextLevel()" style="display:none;">Next ‚ñ∂Ô∏è</button>
  </div>

  <div id="feedback"></div>
</div>

<!-- ================= JAVASCRIPT DO GAME ================= -->
<script>
const family = [
  { word: "Father", img: "father.png", translation: "Pai" },
  { word: "Mother", img: "mother.png", translation: "M√£e" },
  { word: "Brother", img: "brother.png", translation: "Irm√£o" },
  { word: "Sister", img: "sister.png", translation: "Irm√£" },
  { word: "Grandfather", img: "grandfather.png", translation: "Av√¥" },
  { word: "Grandmother", img: "grandmother.png", translation: "Av√≥" },
  { word: "Baby", img: "baby.png", translation: "Beb√™" },
  { word: "Uncle", img: "uncle.png", translation: "Tio" }
];

const home = [
  { word: "Bed", img: "bed.png", translation: "Cama" },
  { word: "Kitchen", img: "kitchen.png", translation: "Cozinha" },
  { word: "House", img: "house.png", translation: "Casa" },
  { word: "Chair", img: "chair.png", translation: "Cadeira" },
  { word: "Window", img: "window.png", translation: "Janela" },
  { word: "Door", img: "door.png", translation: "Porta" },
  { word: "Table", img: "table.png", translation: "Mesa" },
  { word: "Lamp", img: "lamp.png", translation: "L√¢mpada" }
];

const QUESTIONS_FIXED = [
  [ {category:'family', key:'Father'}, {category:'family','key':'Brother'}, {category:'home','key':'Bed'}, {category:'home','key':'Chair'} ],
  [ {category:'family', key:'Mother'}, {category:'family','key':'Sister'}, {category:'home','key':'Window'}, {category:'home','key':'Door'} ],
  [ {category:'family', key:'Grandfather'}, {category:'family','key':'Grandmother'}, {category:'home','key':'Kitchen'}, {category:'home','key':'House'} ],
  [ {category:'family', key:'Baby'}, {category:'family','key':'Uncle'}, {category:'home','key':'Table'}, {category:'home','key':'Lamp'} ],
  [ {category:'family', key:'Father'}, {category:'family','key':'Sister'}, {category:'home','key':'Kitchen'}, {category:'home','key':'Window'} ],
  [ {category:'family', key:'Mother'}, {category:'family','key':'Brother'}, {category:'home','key':'Bed'}, {category:'home','key':'Door'} ],
  [ {category:'family', key:'Grandfather'}, {category:'family','key':'Baby'}, {category:'home','key':'House'}, {category:'home','key':'Chair'} ],
  [ {category:'family', key:'Grandmother'}, {category:'family','key':'Uncle'}, {category:'home','key':'Table'}, {category:'home','key':'Lamp'} ]
];

function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }
function findItemObj(category, key){
  return (category==='family' ? family : home).find(x => x.word === key);
}

let questionsOrder = [];
let currentQuestionIndex = 0;
let score = 0;
let connections = {};
let selectedWordPos = null;
let wordsOnScreen = [];
let imagesOnScreen = [];

function initGame(){
  questionsOrder = shuffle([...Array(QUESTIONS_FIXED.length).keys()]);
  currentQuestionIndex = 0;
  score = 0;
  updateHeader();
  loadQuestion();
}

function updateHeader(){
  document.getElementById('questionNumber').innerText =
    `Question ${currentQuestionIndex+1}/${QUESTIONS_FIXED.length}`;
  document.getElementById('scoreBox').innerText = `Score: ${score}`;
}

function loadQuestion(){
  connections = {};
  selectedWordPos = null;
  document.getElementById('feedback').innerHTML = '';
  document.getElementById('nextBtn').style.display = 'none';
  document.getElementById('checkBtn').style.display = 'inline-block';

  updateHeader();

  const qIdx = questionsOrder[currentQuestionIndex];
  const fixed = QUESTIONS_FIXED[qIdx];

  const items = fixed.map(it => findItemObj(it.category, it.key));
  wordsOnScreen = shuffle(items.map(i => i.word));
  imagesOnScreen = shuffle([...items]);

  render();
}

function render(){
  const wordsDiv = document.getElementById('words');
  const imagesDiv = document.getElementById('images');
  const svg = document.getElementById('lines-svg');

  wordsDiv.innerHTML = '';
  imagesDiv.innerHTML = '';
  svg.innerHTML = '';

  wordsOnScreen.forEach((w, idx) => {
    const el = document.createElement('div');
    el.className = 'word-box';
    el.id = 'w'+idx;
    el.innerText = w;
    el.onclick = ()=> selectWord(idx);
    wordsDiv.appendChild(el);
  });

  imagesOnScreen.forEach((itm, idx) => {
    const el = document.createElement('div');
    el.className = 'img-box';
    el.id = 'i'+idx;
    el.onclick = ()=> connectImage(idx);
    const img = document.createElement('img');
    const folder = (family.some(f=>f.word===itm.word) ? 'family' : 'home');
    img.src = `${folder}/${itm.img}`;
    img.alt = itm.word;
    el.appendChild(img);
    imagesDiv.appendChild(el);
  });
}

function selectWord(pos){
  selectedWordPos = pos;
  document.querySelectorAll('.word-box').forEach(el=>el.style.outline='none');
  const el = document.getElementById('w'+pos);
  if(el) el.style.outline = '3px solid #3b82f6';
}

function connectImage(imgPos){
  if(selectedWordPos===null) return;
  connections[selectedWordPos] = imgPos;
  selectedWordPos = null;
  document.querySelectorAll('.word-box').forEach(el=>el.style.outline='none');
  drawLines();
}

function drawLines(){
  const svg = document.getElementById('lines-svg');
  svg.innerHTML = '';
  const sr = svg.getBoundingClientRect();
  Object.keys(connections).forEach(ws=>{
    const wIdx = Number(ws);
    const iIdx = connections[ws];
    const wEl = document.getElementById('w'+wIdx);
    const iEl = document.getElementById('i'+iIdx);
    if(!wEl || !iEl) return;
    const wr = wEl.getBoundingClientRect();
    const ir = iEl.getBoundingClientRect();
    const x1 = wr.right - sr.left;
    const y1 = wr.top + wr.height/2 - sr.top;
    const x2 = ir.left - sr.left;
    const y2 = ir.top + ir.height/2 - sr.top;
    const line = document.createElementNS("http://www.w3.org/2000/svg",'line');
    line.setAttribute('x1',x1);
    line.setAttribute('y1',y1);
    line.setAttribute('x2',x2);
    line.setAttribute('y2',y2);
    line.setAttribute('stroke','purple');
    line.setAttribute('stroke-width','4');
    line.setAttribute('stroke-linecap','round');
    svg.appendChild(line);
  });
}

function checkMatch(){
  let correct = 0;
  let explanation = '';

  for(let wPos=0; wPos<4; wPos++){
    const word = wordsOnScreen[wPos];
    const mappedImgPos = connections[wPos];
    const originalObj = (()=>{
      const fixed = QUESTIONS_FIXED[questionsOrder[currentQuestionIndex]];
      const found = fixed.find(x=>x.key===word);
      return findItemObj(found.category, found.key);
    })();

    if(typeof mappedImgPos === 'number'){
      const chosenObj = imagesOnScreen[mappedImgPos];
      if(chosenObj.word === word){
        correct++;
        explanation += `‚úîÔ∏è <b>${word}</b> = ${originalObj.translation}<br>`;
      } else {
        explanation += `‚ùå <b>${word}</b> = ${originalObj.translation} (Voc√™ ligou em <b>${chosenObj.word}</b>)<br>`;
      }
    } else {
      explanation += `‚ùå <b>${word}</b> = ${originalObj.translation} (N√£o ligado)<br>`;
    }
  }

  score += correct * 10;
  document.getElementById('feedback').innerHTML =
    `You got <b>${correct}/4</b> correct!<br><br>${explanation}`;
  document.getElementById('scoreBox').innerText = `Score: ${score}`;
  document.getElementById('checkBtn').style.display = 'none';
  document.getElementById('nextBtn').style.display = 'inline-block';
}

function nextLevel(){
  if(currentQuestionIndex < QUESTIONS_FIXED.length - 1){
    currentQuestionIndex++;
    loadQuestion();
    updateHeader();
  } else {
    document.querySelector('.game-container').innerHTML = `
      <h2>üéâ Parab√©ns!</h2>
      <p>Final Score: <b>${score}</b> / 320</p>
      <button class="btn btn-warning" onclick="location.reload()">Play Again</button>
    `;
  }
}

initGame();
</script>

</body>
</html>
