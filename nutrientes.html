<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üå± Jogo dos Nutrientes üåΩ</title>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(to bottom, #d0f0c0, #fff);
      font-family: 'Comic Sans MS', sans-serif;
      padding: 20px;
      background-image: url(nutrientes.png);
      background-size: cover;
      background-position: center;
      min-height: 100vh;
    }

    .quiz-box {
      max-width: 700px;
      margin: auto;
      background: #fff8e7;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0, 100, 0, 0.2);
      border: 3px dashed #a3c586;
    }

    h3, h4 { color: #4e944f; }
    .vidas { color: #d62828; font-weight: bold; }

    .btn-option {
      margin-bottom: 10px;
      text-align: left;
      background-color: #d0ead2;
      border: 2px solid #4e944f;
      color: #333;
      font-weight: bold;
      transition: transform 0.2s, background-color 0.3s;
    }

    .btn-option:hover { background-color: #a3c586; transform: scale(1.02); }

    #explicacao { display: none; margin-top: 20px; text-align: center; }
    #explicacao img { max-width: 200px; margin-top: 10px; border-radius: 12px; border: 2px solid #4e944f; }

    .header-box {
      background-color: #a3c586;
      padding: 10px 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      color: #fff;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }

    .container-final {
      max-width: 700px;
      margin: 30px auto;
      background-color: white;
      padding: 20px;
      border-radius: 15px;
      border: 5px solid #4e944f;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #chart-container { width: 100%; height: 300px; margin: 20px 0; }
  </style>
</head>
<body>
  <div class="quiz-box" id="caixa-principal">
    <div class="header-box">üåø M√≥dulo dos Nutrientes üçì</div>

    <div id="tela-nome" class="text-center">
      <img src="logo_nutrientes.png" alt="Logo" style="max-width: 250px; margin-bottom: 20px; border-radius: 10%;"/>
      <br>
      <h3>üë©‚Äçüåæ Digite seu nome para come√ßar:</h3>
      <input type="text" id="nome-jogador" class="form-control mb-3" style="max-width:300px; margin:auto; border: 2px solid #4e944f;" placeholder="Seu nome" />
      <button class="btn btn-success" onclick="iniciarJogo()">Come√ßar</button>
    </div>

    <div id="jogo" style="display: none;">
      <div class="d-flex justify-content-between">
        <div><strong>üë§ Jogador:</strong> <span id="jogador"></span></div>
        <div><strong>‚≠ê Pontos:</strong> <span id="pontos">0</span></div>
        <div><strong>‚ù§Ô∏è Vidas:</strong> <span id="vidas" class="vidas">5</span></div>
      </div>
      <hr />
      <div>
        <h4 id="pista">üîç</h4>
        <div id="opcoes" class="mt-3"></div>
        <div id="explicacao">
          <p id="texto-explicacao"></p>
          <img id="imagem-explicacao" src="" alt="Imagem do alimento">
          <br>
          <button class="btn btn-primary mt-3" onclick="proximaPergunta()">üå± Continuar</button>
        </div>
      </div>
    </div>
  </div>

  <div id="restart-container" class="container-final text-center" style="display: none;">
    <h2>üéâ Parab√©ns, <span id="final-nome"></span>!</h2>
    <p>Voc√™ completou o m√≥dulo de Nutrientes.</p>
    <div id="chart-container"><canvas id="graficoPontos"></canvas></div>
    <button class="btn btn-dark mb-2" onclick="gerarPDF()">üìÑ Gerar Boletim Detalhado</button>
    <br>
    <button class="btn btn-success me-2" onclick="location.reload()">üîÑ Reiniciar</button>
    <button class="btn btn-primary" onclick="goToNextModule()">‚û°Ô∏è Voltar ao In√≠cio</button>
  </div>

  <script>
    const perguntas = [
      { pistas: ["1. Sou uma fruta tropical rica em pot√°ssio. (10 pts)", "2. Ajudo a prevenir c√¢imbras musculares. (7 pts)", "3. Tenho uma casca amarela e sou muito consumida no Brasil. (5 pts)"], resposta: "Banana", opcoes: ["Ma√ß√£", "Banana", "Laranja", "Abacaxi", "Mel√£o"], explicacao: "A banana √© rica em pot√°ssio e excelente para os m√∫sculos.", imagem: "banana.png" },
      { pistas: ["1. Sou verde, folhoso e cheio de ferro. (10 pts)", "2. Ajudo na preven√ß√£o da anemia. (7 pts)", "3. Sou muito usado em saladas e sucos detox. (5 pts)"], resposta: "Espinafre", opcoes: ["Alface", "Couve", "Espinafre", "Agri√£o", "R√∫cula"], explicacao: "O espinafre √© uma excelente fonte de ferro e outros nutrientes.", imagem: "espinafre.png" },
      { pistas: ["1. Sou um tub√©rculo e fonte de energia. (10 pts)", "2. Sou rico em carboidratos e vitaminas do complexo B. (7 pts)", "3. Frito, cozido ou pur√™, estou sempre presente nas refei√ß√µes. (5 pts)"], resposta: "Batata", opcoes: ["Inhame", "Batata", "Mandioquinha", "Cenoura", "Car√°"], explicacao: "A batata √© rica em carboidratos e fornece energia rapidamente.", imagem: "batata.png" },
      { pistas: ["1. Sou uma leguminosa rica em prote√≠nas vegetais. (10 pts)", "2. Sou muito usada em feijoadas e pratos brasileiros. (7 pts)", "3. Tenho uma casca escura e sou muito popular no Brasil. (5 pts)"], resposta: "Feij√£o", opcoes: ["Lentilha", "Gr√£o-de-bico", "Feij√£o", "Ervilha", "Soja"], explicacao: "O feij√£o √© fonte de prote√≠na vegetal e ferro, essencial na dieta brasileira.", imagem: "feijao.png" },
      { pistas: ["1. Sou uma fruta c√≠trica rica em vitamina C. (10 pts)", "2. Ajudar na imunidade √© comigo mesmo! (7 pts)", "3. Sou muito usada em sucos no caf√© da manh√£. (5 pts)"], resposta: "Laranja", opcoes: ["Lim√£o", "Tangerina", "Abacaxi", "Laranja", "Caju"], explicacao: "A laranja √© excelente fonte de vitamina C, fortalecendo o sistema imunol√≥gico.", imagem: "laranja.png" },
      { pistas: ["1. Sou uma raiz rica em betacaroteno. (10 pts)", "2. Sou boa para a vis√£o e a pele. (7 pts)", "3. Minha cor √© laranja vibrante! (5 pts)"], resposta: "Cenoura", opcoes: ["Ab√≥bora", "Cenoura", "Mandioquinha", "Inhame", "Beterraba"], explicacao: "A cenoura √© rica em betacaroteno, essencial para a sa√∫de dos olhos.", imagem: "cenoura.png" },
      { pistas: ["1. Sou um vegetal roxo e cheio de antioxidantes. (10 pts)", "2. Sou usado em saladas, sucos e at√© sobremesas. (7 pts)", "3. Posso ajudar na press√£o e circula√ß√£o. (5 pts)"], resposta: "Beterraba", opcoes: ["Uva", "Cenoura", "Beterraba", "Repolho Roxo", "Amora"], explicacao: "A beterraba √© rica em nitratos naturais que ajudam a regular a press√£o arterial.", imagem: "beterraba.png" },
      { pistas: ["1. Sou um cereal integral muito nutritivo. (10 pts)", "2. Ajudo no funcionamento do intestino. (7 pts)", "3. Costumo ser consumido com iogurte ou frutas. (5 pts)"], resposta: "Aveia", opcoes: ["Granola", "Farinha de trigo", "Centeio", "Aveia", "Quinoa"], explicacao: "A aveia √© rica em fibras e ideal para a sa√∫de digestiva.", imagem: "aveia.png" }
    ];

    let indice = 0;
    let pontuacao = 0;
    let vidas = 5;
    let etapaPista = 0;
    let nome = "";
    let opcoesErradas = [];
    
    // VARI√ÅVEIS PARA LOG E GR√ÅFICO
    let logRespostas = [];
    let historicoPontos = [0];

    function iniciarJogo() {
      nome = document.getElementById("nome-jogador").value;
      if (!nome) return alert("üåº Digite seu nome para come√ßar!");
      document.getElementById("tela-nome").style.display = "none";
      document.getElementById("jogo").style.display = "block";
      document.getElementById("jogador").textContent = nome;
      carregarPergunta();
    }

    function carregarPergunta() {
      const pergunta = perguntas[indice];
      document.getElementById("pista").textContent = pergunta.pistas[etapaPista];
      const opcoesContainer = document.getElementById("opcoes");
      opcoesContainer.innerHTML = "";
      document.getElementById("explicacao").style.display = "none";

      pergunta.opcoes.forEach(opcao => {
        const btn = document.createElement("button");
        btn.className = "btn btn-option w-100";
        btn.textContent = opcao;
        btn.disabled = opcoesErradas.includes(opcao);
        btn.onclick = () => verificarResposta(opcao);
        opcoesContainer.appendChild(btn);
      });
    }

    function verificarResposta(opcao) {
      const pergunta = perguntas[indice];
      const correta = (opcao === pergunta.resposta);

      // Salva a tentativa no Log
      logRespostas.push({
        pergunta: indice + 1,
        tentativa: opcao,
        resultado: correta ? "Correto" : "Errado",
        pistaNivel: etapaPista + 1
      });

      if (correta) {
        const pontosGanhos = etapaPista === 0 ? 10 : etapaPista === 1 ? 7 : 5;
        pontuacao += pontosGanhos;
        historicoPontos.push(pontuacao);
        document.getElementById("pontos").textContent = pontuacao;
        
        // Adiciona Gabarito ao Log para confer√™ncia
        logRespostas.push({
          pergunta: indice + 1,
          tentativa: "GABARITO",
          resultado: "Oficial",
          pistaNivel: pergunta.resposta
        });

        mostrarExplicacao(pergunta);
      } else {
        opcoesErradas.push(opcao);
        etapaPista++;
        if (etapaPista >= 3) {
          vidas--;
          document.getElementById("vidas").textContent = vidas;
          historicoPontos.push(pontuacao); // Ponto n√£o sobe
          mostrarExplicacao(pergunta);
          if (vidas <= 0) {
              alert("As vidas acabaram! Tente novamente.");
              location.reload();
          }
        } else {
          carregarPergunta();
        }
      }
    }

    function mostrarExplicacao(pergunta) {
      document.getElementById("opcoes").innerHTML = "";
      document.getElementById("pista").textContent = `‚úÖ Resposta: ${pergunta.resposta}`;
      document.getElementById("texto-explicacao").textContent = pergunta.explicacao;
      document.getElementById("imagem-explicacao").src = pergunta.imagem;
      document.getElementById("explicacao").style.display = "block";
    }

    function proximaPergunta() {
      etapaPista = 0;
      opcoesErradas = [];
      indice++;
      if (indice < perguntas.length) {
        carregarPergunta();
      } else {
        finalizarModulo();
      }
    }

    function finalizarModulo() {
      document.getElementById("caixa-principal").style.display = "none";
      document.getElementById("restart-container").style.display = "block";
      document.getElementById("final-nome").textContent = nome;

      // Criar Gr√°fico
      const ctx = document.getElementById('graficoPontos').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: historicoPontos.map((_, i) => i === 0 ? "In√≠cio" : `Quest√£o ${i}`),
          datasets: [{
            label: 'Pontua√ß√£o Acumulada',
            data: historicoPontos,
            borderColor: '#4e944f',
            backgroundColor: 'rgba(78, 148, 79, 0.2)',
            fill: true,
            tension: 0.3
          }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
    }

    function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      // Cabe√ßalho Verde Tem√°tico
      doc.setFillColor(78, 148, 79);
      doc.rect(0, 0, 210, 20, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(16);
      doc.text("BOLETIM - M√ìDULO NUTRIENTES", 15, 13);
      
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(12);
      doc.text(`Aluno: ${nome}`, 15, 30);
      doc.text(`Pontua√ß√£o Total: ${pontuacao} pontos`, 15, 38);

      // Preparando os dados: Quest√£o | Escolha | Gabarito | Resultado
      const tableData = logRespostas.filter(item => item.resultado !== "Oficial").map(item => {
        const perguntaOriginal = perguntas[item.pergunta - 1];
        return [
          item.pergunta,
          item.tentativa,
          perguntaOriginal.resposta, // Coluna Gabarito
          item.resultado
        ];
      });

      doc.autoTable({
        startY: 45,
        head: [['Qst.', 'Sua Escolha', 'Gabarito Oficial', 'Resultado']],
        body: tableData,
        headStyles: { fillColor: [78, 148, 79] },
        styles: { fontSize: 9 },
        theme: 'striped',
        didParseCell: function(data) {
          // Destaca a coluna Resultado (√≠ndice 3)
          if (data.section === 'body' && data.column.index === 3) {
            if (data.cell.raw === 'Correto') {
              data.cell.styles.textColor = [0, 128, 0];
              data.cell.styles.fontStyle = 'bold';
            }
            if (data.cell.raw === 'Errado') {
              data.cell.styles.textColor = [200, 0, 0];
            }
          }
          // Destaca a coluna Gabarito (√≠ndice 2) para facilitar a leitura
          if (data.section === 'body' && data.column.index === 2) {
            data.cell.styles.fontStyle = 'italic';
            data.cell.styles.textColor = [50, 50, 50];
          }
        }
      });

      doc.save(`boletim_nutrientes_${nome}.pdf`);
    }
    function goToNextModule() { window.location.href = "index.html"; }
  </script>
</body> 
</html>