<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Palavra Certa ‚Äì Ortografia Confusiva</title>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #2c2c2c;
      background-image: url('palavras.png');
      background-size: cover;
      color: #fff;
      padding: 20px;
      margin: 0;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: #1c1c1c;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      text-align: center;
    }

    h1, h2 { color: #ffd700; }
    .question { font-size: 1.2em; margin: 30px 0 20px; }

    .options button {
      background: #fff;
      color: #000;
      border: none;
      padding: 12px 20px;
      margin: 10px 0;
      width: 100%;
      font-size: 1em;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .options button:hover { background: #ffd700; }
    .feedback { margin-top: 20px; font-weight: bold; }
    .correct { color: #28a745; }
    .wrong { color: #dc3545; }
    .scoreboard { margin-top: 10px; font-size: 1em; }

    #next-btn {
      margin-top: 20px; padding: 10px 20px; font-size: 1em;
      border: none; background: #007bff; color: white;
      border-radius: 8px; cursor: pointer; display: none;
    }

    .explanation {
      margin-top: 15px; text-align: left; background: #333;
      padding: 15px; border-radius: 8px; font-size: 0.95em;
    }

    .word { color: #ffd700; font-weight: bold; }

    #chart-container {
      background: white;
      border-radius: 8px;
      margin: 20px 0;
      padding: 10px;
    }

    #start-screen { max-width: 400px; margin: 100px auto; background: #222; padding: 25px; border-radius: 12px; text-align: center; }
    #start-screen img { max-width: 250px; margin-bottom: 20px; border-radius: 10%; }
    #player-name { padding: 10px; width: 80%; border-radius: 8px; border: none; margin-bottom: 15px; font-size: 1em; }
    
    #start-btn, .btn {
      padding: 10px 30px; font-size: 1.1em; border: none;
      background-color: #ffd700; color: #000; border-radius: 8px;
      cursor: pointer; transition: 0.3s; margin: 5px;
    }

    .btn-next-module { background-color: #28a745; color: white; }
    .btn-pdf { background-color: #8b4513; color: white; } 
  </style>
</head>
<body>

  <div id="start-screen" class="container">
    <h2>M√≥dulo Hom√¥nimas e Par√¥nimas</h2>
    <img src="logo_palavras.png" alt="Logo" />
    <input type="text" id="player-name" placeholder="Digite seu nome" />
    <br />
    <button id="start-btn">Iniciar</button>
  </div>

  <div id="quiz-container" class="container" style="display:none;">
    <h1>üß† Palavra Certa</h1>
    <div id="game">
      <div class="scoreboard">
        <strong>Jogador:</strong> <span id="player-display"></span> |
        <strong>Pontua√ß√£o:</strong> <span id="score">0</span> |
        <strong>Vidas:</strong> <span id="lives">5</span>
      </div>
      <div class="question" id="question"></div>
      <div class="options" id="options"></div>
      <div class="feedback" id="feedback"></div>
      <div class="explanation" id="explanation"></div>
      <button id="next-btn">Pr√≥xima</button>
    </div>
  </div>

  <div id="end-screen" class="container" style="display:none;">
    <h2>üéâ Parab√©ns, <span id="final-player-name"></span>!</h2>
    <p>Voc√™ terminou com <strong><span id="final-score"></span> ponto(s)</strong>!</p>
    
    <div id="chart-container">
      <canvas id="scoreChart"></canvas>
    </div>

    <button class="btn btn-pdf" onclick="generatePDF()">üì• Baixar Boletim PDF</button>
    <br>
    <button class="btn" onclick="location.reload()">üîÑ Jogar Novamente</button>
    <button class="btn btn-next-module" onclick="goToNextModule()">‚û°Ô∏è Pr√≥ximo M√≥dulo</button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const startScreen = document.getElementById('start-screen');
      const quizContainer = document.getElementById('quiz-container');
      const endScreen = document.getElementById('end-screen');
      const startBtn = document.getElementById('start-btn');
      const playerNameInput = document.getElementById('player-name');
      const playerDisplay = document.getElementById('player-display');
      const questionEl = document.getElementById("question");
      const optionsEl = document.getElementById("options");
      const feedbackEl = document.getElementById("feedback");
      const explanationEl = document.getElementById("explanation");
      const scoreEl = document.getElementById("score");
      const livesEl = document.getElementById("lives");
      const nextBtn = document.getElementById("next-btn");

      let current = 0;
      let score = 0;
      let lives = 5;
      let playerName = "";
      let scoreHistory = [0]; 
      let reportData = [];

      const questions = [
        { sentence: "O m√∫sico fez um √≥timo ______ ontem no teatro.", options: { "Concerto": "Apresenta√ß√£o musical.", "Conserto": "Ato de reparar." }, answer: "Concerto" },
        { sentence: "O mec√¢nico terminou o ______ do carro.", options: { "Conserto": "Reparar algo quebrado.", "Concerto": "Harmonia de sons." }, answer: "Conserto" },
        { sentence: "Vamos marcar uma ______ de cinema √† noite.", options: { "Sess√£o": "Per√≠odo de atividade.", "Se√ß√£o": "Divis√£o.", "Cess√£o": "Ato de ceder." }, answer: "Sess√£o" },
        { sentence: "A empresa far√° a ______ de direitos autorais.", options: { "Cess√£o": "Abrir m√£o.", "Se√ß√£o": "Parte subdividida.", "Sess√£o": "Per√≠odo." }, answer: "Cess√£o" },
        { sentence: "O livro foi colocado na ______ infantil.", options: { "Se√ß√£o": "Divis√£o/Setor.", "Sess√£o": "Per√≠odo.", "Cess√£o": "Ato de ceder." }, answer: "Se√ß√£o" },
        { sentence: "Ele me deu um caloroso ______.", options: { "Cumprimento": "Sauda√ß√£o.", "Comprimento": "Medida." }, answer: "Cumprimento" },
        { sentence: "O ______ da sala era de dez metros.", options: { "Comprimento": "Medida.", "Cumprimento": "Sauda√ß√£o." }, answer: "Comprimento" },
        { sentence: "Ela colocou um ______ confort√°vel na cadeira.", options: { "Assento": "Lugar de sentar.", "Acento": "Sinal gr√°fico." }, answer: "Assento" },
        { sentence: "A palavra 'p√¥de' tem um ______ circunflexo.", options: { "Acento": "Sinal gr√°fico.", "Assento": "Lugar de sentar." }, answer: "Acento" },
        { sentence: "Ele vai ______ para o Canad√°.", options: { "Emigrar": "Sair do pa√≠s.", "Imigrar": "Entrar no pa√≠s." }, answer: "Emigrar" },
        { sentence: "Ela vai ______ para o Brasil.", options: { "Imigrar": "Entrar no pa√≠s.", "Emigrar": "Sair do pa√≠s." }, answer: "Imigrar" },
        { sentence: "O ______ do IBGE revelou crescimento.", options: { "Censo": "Estat√≠stica.", "Senso": "Julgamento." }, answer: "Censo" },
        { sentence: "Ele tem um bom ______ de justi√ßa.", options: { "Senso": "Julgamento.", "Censo": "Estat√≠stica." }, answer: "Senso" },
        { sentence: "Ela foi ______ pelas regras da competi√ß√£o.", options: { "Infligida": "Puni√ß√£o aplicada.", "Infringida": "Regra violada." }, answer: "Infligida" },
        { sentence: "Ele ______ as regras e foi desclassificado.", options: { "Infringiu": "Violou.", "Infligiu": "Aplicou pena." }, answer: "Infringiu" },
        { sentence: "O ____ do carro quebrou.", options: { "Cinto": "Correia de seguran√ßa.", "Sinto": "Verbo sentir." }, answer: "Cinto" },
        { sentence: "O diretor vai ____ o documento amanh√£.", options: { "Ratificar": "Confirmar.", "Retificar": "Corrigir." }, answer: "Ratificar" }
      ];

      // Algoritmo Fisher-Yates para embaralhar qualquer array
      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      function showQuestion() {
        const q = questions[current];
        questionEl.textContent = q.sentence;
        optionsEl.innerHTML = "";
        feedbackEl.textContent = "";
        explanationEl.textContent = "";
        nextBtn.style.display = "none";

        // Transforma as chaves do objeto em array e as embaralha
        const keys = Object.keys(q.options);
        const shuffledOptions = shuffleArray(keys);

        shuffledOptions.forEach(word => {
          const btn = document.createElement("button");
          btn.textContent = word;
          btn.onclick = () => checkAnswer(word);
          optionsEl.appendChild(btn);
        });
      }

      function checkAnswer(selected) {
        const q = questions[current];
        const isCorrect = (selected === q.answer);
        
        // Desativa bot√µes ap√≥s escolha
        const buttons = optionsEl.querySelectorAll("button");
        buttons.forEach(b => b.disabled = true);

        if (isCorrect) {
          score += 10;
          feedbackEl.textContent = "‚úÖ Correto!";
          feedbackEl.className = "feedback correct";
        } else {
          lives--;
          feedbackEl.textContent = `‚ùå Errado! Resposta: "${q.answer}".`;
          feedbackEl.className = "feedback wrong";
        }

        reportData.push({
          pergunta: q.sentence.replace("______", q.answer),
          escolhida: selected,
          status: isCorrect ? "Acertou" : "Errou"
        });
        scoreHistory.push(score);

        scoreEl.textContent = score;
        livesEl.textContent = lives;
        showExplanations(q.options);
        nextBtn.style.display = "inline-block";

        if (lives <= 0) setTimeout(gameOver, 800);
      }

      function showExplanations(options) {
        explanationEl.innerHTML = "<strong>üìö Significados:</strong><br><br>";
        for (let [word, meaning] of Object.entries(options)) {
          explanationEl.innerHTML += `<p><span class="word">${word}</span>: ${meaning}</p>`;
        }
      }

      function gameOver() {
        quizContainer.style.display = "none";
        endScreen.style.display = "block";
        document.getElementById("final-score").textContent = score;
        document.getElementById("final-player-name").textContent = playerName;
        renderChart();
      }

      function renderChart() {
        const ctx = document.getElementById('scoreChart').getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: scoreHistory.map((_, i) => `Q${i}`),
            datasets: [{
              label: 'Pontua√ß√£o',
              data: scoreHistory,
              borderColor: '#8b4513',
              backgroundColor: 'rgba(139, 69, 19, 0.2)',
              borderWidth: 3,
              tension: 0.3,
              fill: true
            }]
          },
          options: { scales: { y: { beginAtZero: true } } }
        });
      }

      window.generatePDF = function() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(18);
        doc.setTextColor(139, 69, 19);
        doc.text("BOLETIM DE DESEMPENHO", 105, 20, { align: "center" });
        doc.setFontSize(12);
        doc.setTextColor(0);
        doc.text(`Jogador: ${playerName}`, 14, 35);
        doc.text(`Pontua√ß√£o Total: ${score}`, 14, 42);

        const rows = reportData.map(item => [item.pergunta, item.escolhida, item.status]);
        doc.autoTable({
          startY: 50,
          head: [['Senten√ßa', 'Sua Escolha', 'Resultado']],
          body: rows,
          headStyles: { fillColor: [139, 69, 19] },
          didParseCell: (data) => {
            if (data.column.index === 2 && data.cell.section === 'body') {
              data.cell.styles.textColor = data.cell.raw === 'Acertou' ? [40, 167, 69] : [220, 53, 69];
            }
          }
        });
        doc.save(`Boletim_${playerName}.pdf`);
      }

      nextBtn.onclick = () => {
        current++;
        if (current >= questions.length) gameOver();
        else showQuestion();
      };

      startBtn.onclick = () => {
        playerName = playerNameInput.value.trim();
        if (!playerName) { alert('Digite seu nome!'); return; }
        playerDisplay.textContent = playerName;
        startScreen.style.display = 'none';
        quizContainer.style.display = 'block';
        
        // Embaralha as perguntas ao iniciar
        shuffleArray(questions);
        
        showQuestion();
      };

      window.goToNextModule = function() {
        window.location.href = "compreens√£o_e_interpreta√ß√£o.html";
      };
    });
  </script>
</body>
</html>