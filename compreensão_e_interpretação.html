<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hist√≥rias para Interpretar</title>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-image: url('compreensao_e_interpretacao.png');
      color: #fff;
      margin: 0;
      padding: 0 20px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .container {
      background: #2c2c54;
      max-width: 600px;
      width: 100%;
      padding: 30px 25px 40px 25px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
      text-align: center;
    }
    h1 {
      margin-bottom: 10px;
      color: #ffd700;
    }
    #start-screen input[type="text"] {
      padding: 10px;
      font-size: 1.1em;
      width: 80%;
      border-radius: 8px;
      border: none;
      margin-bottom: 20px;
    }
    button {
      background-color: #ffd700;
      border: none;
      padding: 12px 30px;
      font-size: 1.1em;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      color: #2c2c54;
      font-weight: bold;
      margin-top: 10px;
    }
    button:hover {
      background-color: #e6c200;
    }
    #game {
      display: none;
    }
    .story-image {
      width: 180px;
      height: 180px;
      border-radius: 25%;
      object-fit: cover;
      margin: 20px auto;
      display: block;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
      border: 3px solid #ffd700;
    }
    .story-text {
      font-size: 1.1em;
      margin-bottom: 25px;
      line-height: 1.5em;
    }
    .question {
      font-size: 1.25em;
      margin-bottom: 15px;
      font-weight: 600;
    }
    .options button {
      background: #fff;
      color: #2c2c54;
      margin: 10px 0;
      width: 100%;
      padding: 12px;
      font-size: 1em;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }
    .options button:hover {
      background: #ffd700;
      border-color: #e6c200;
    }
    .feedback {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.1em;
      min-height: 30px;
    }
    .correct { color: #28a745; }
    .wrong { color: #dc3545; }
    
    .scoreboard {
      font-size: 1em;
      margin-bottom: 15px;
    }
    #next-btn {
      margin-top: 25px;
      padding: 12px 28px;
      background-color: #28a745;
      color: white;
      display: none;
    }

    /* Estilos do Gr√°fico e Bot√µes Finais */
    #chart-container {
      background: white;
      border-radius: 8px;
      margin: 20px 0;
      padding: 10px;
    }
    .btn {
      font-size: 1.1em;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      margin: 10px;
      font-weight: bold;
    }
    .btn-restart { background-color: #ffd700; color: #000; }
    .btn-next-module { background-color: #28a745; color: white; }
    .btn-pdf { background-color: #8b4513; color: white; } 
  </style>
</head>
<body>

  <div class="container" id="start-screen">
    <h1>üìö Hist√≥rias para Interpretar</h1>
    <img src="logo_textos.png" alt="Logo" style="max-width: 250px; margin-bottom: 20px; border-radius: 10%;"/>
    <input type="text" id="player-name" placeholder="Seu nome aqui" maxlength="20" />
    <br />
    <button id="start-btn">Iniciar</button>
  </div>

  <div class="container" id="game">
    <div class="scoreboard">
      <strong>Jogador:</strong> <span id="display-name"></span> |
      <strong>Pontua√ß√£o:</strong> <span id="score">0</span> |
      <strong>Vidas:</strong> <span id="lives">3</span>
    </div>
    <img src="" alt="Imagem da hist√≥ria" id="story-image" class="story-image" />
    <div class="story-text" id="story-text">Carregando hist√≥ria...</div>
    <div class="question" id="question"></div>
    <div class="options" id="options"></div>
    <div class="feedback" id="feedback"></div>
    <button id="next-btn">Pr√≥xima hist√≥ria</button>
  </div>

  <div class="container" id="end-screen" style="display:none;">
    <h2>üéâ Parab√©ns, <span id="final-player-name"></span>!</h2>
    <p>Voc√™ terminou com <strong><span id="final-score"></span> ponto(s)</strong>!</p>
    
    <div id="chart-container">
      <canvas id="scoreChart"></canvas>
    </div>

    <button class="btn btn-pdf" onclick="generatePDF()">üì• Baixar Boletim PDF</button>
    <br>
    <button class="btn btn-restart" onclick="location.reload()">üîÑ Jogar Novamente</button>
    <button class="btn btn-next-module" onclick="goToNextModule()">‚û°Ô∏è Finalizar M√≥dulos</button>
  </div>

  <div class="container" id="lost-container" style="display:none;">
    <h2>üíî Voc√™ perdeu! Que tal tentar novamente?</h2>
    <button class="btn btn-restart" onclick="restartGame()">üîÑ Tentar Novamente</button>
  </div>

  <script>
    const stories = [
      {
        text: "Lucas encontrou um passarinho ferido no parque...",
        image: "h1_lucas_passarinho.png",
        question: "O que podemos concluir sobre Lucas?",
        options: ["Ele demonstrou cuidado e paci√™ncia", "Ele tem medo de passarinho", "Ele deu comida para o passarinho"],
        answer: 0
      },
      {
        text: "Maria plantou uma sementinha no jardim da sua casa. Ela regava a planta todos os dias, mesmo quando estava chovendo. Maria tamb√©m tirava as folhas secas e conversava com a plantinha, esperando que ela crescesse forte e bonita. Com o tempo, a sementinha virou uma flor cheia de cores.",
        image: "h2_maria_plantinha.png",
        question: "Qual das alternativas N√ÉO faz parte do cuidado que Maria teve com a planta?",
        options: ["Regar a sementinha todos os dias.", "Esquecer de cuidar da planta quando chove.", "Tirar suas folhas secas"],
        answer: 1
      },
      {
        text: "No dia em que o sol brilhava muito forte, Ana decidiu se cuidar. Ela colocou um chap√©u grande para proteger a cabe√ßa e levou uma garrafinha de √°gua para n√£o ficar desidratada. Ana sabia que o calor podia causar cansa√ßo e que era importante se proteger para brincar e aproveitar o dia.",
        image: "h3_ana_chap√©u.png",
        question: "Por que Ana tomou as atitudes mencionadas na hist√≥ria?",
        options: ["Para se proteger do calor e evitar o cansa√ßo.", "Porque queria se sentir mais bonita.", "Porque ela queria ficar na sombra para dormir."],
        answer: 0
      },
      {
        text: "Jo√£o encontrou um cachorrinho perdido enquanto caminhava no bairro. Ele percebeu que o cachorro n√£o tinha coleira e parecia confuso. Jo√£o pegou uma coleira que tinha em casa, colocou no cachorro e o levou para passear. Voltando para casa, postou um an√∫ncio informando ter encontrado o c√£o para tentar localizar o poss√≠vel dono.",
        image: "h4_jo√£o_cachorro.png",
        question: "As atitudes de Jo√£o revelam que:",
        options: ["Ele quer encontrar o dono, pois n√£o gosta de cachorros.", "Ele levou o cachorro para passear, pois j√° o considera seu.", "Ele demonstrou preocupa√ß√£o com o cachorro e com seu poss√≠vel dono."],
        answer: 2
      },
      {
        text: "Durante a aula, Clara n√£o entendeu muito bem a explica√ß√£o do professor. Por isso, ela fez v√°rias perguntas para tirar suas d√∫vidas e entender melhor o assunto. Clara sabia que perguntar era importante para aprender e se dedicar mais aos estudos.",
        image: "h5_clara_professor.png",
        question: "O que podemos dizer sobre Clara?",
        options: ["Ela quer aprender e compreende a import√¢ncia de tirar d√∫vidas.", "Ela n√£o estava prestando aten√ß√£o na aula.", "Ela estava conversando com os colegas durante a explica√ß√£o."],
        answer: 0
      },
      {
        text: "Pedro ajudou sua av√≥ na cozinha. Enquanto ela cortava os legumes, Pedro lavava a lou√ßa e arrumava a mesa. Al√©m disso, aprendeu uma receita nova de sopa que sua av√≥ fez e gostou muito do sabor que ficou.",
        image: "h6_pedro_av√≥.png",
        question: "O que Pedro fez com sua av√≥?",
        options: [
          "Ele ajudou ela a limpar a cozinha.",
          "Ele ajudou a av√≥, enquanto ela cuidava da sopa.",
          "Ele fez sozinho a sopa que aprendeu com a av√≥."
        ],
        answer: 1
      },
      {
        text: "No zool√≥gico, Lara ficou encantada com os animais. Ela observou cada um com muita aten√ß√£o e anotou v√°rias curiosidades para usar no trabalho da escola. Lara queria aprender mais sobre os animais e mostrou bastante interesse durante a visita.",
        image: "h7_lara_zoologico.png",
        question: "A postura de Lara mostra que:",
        options: [
          "Ela estava pensando apenas em tirar uma nota boa.",
          "Ela se interessou pelos animais e suas curiosidades.",
          "Ela ficou bastante encantada com o zool√≥gico."
        ],
        answer: 1
      },
      {
        text: "Miguel acordou cedo no s√°bado para ir ao parque com seus amigos. Eles passaram a manh√£ jogando bola, correndo e se divertindo muito. Miguel adorou estar ao ar livre e brincar com seus colegas depois de uma semana de aula.",
        image: "h8_miguel_s√°bado.png",
        question: "Com base no texto podemos afirmar que Miguel:",
        options: [
          "Normalmente acorda tarde aos s√°bados.",
          "Miguel brinca com seus amigos no col√©gio e no parque.",
          "Miguel teve um momento de lazer com seus amigos."
        ],
        answer: 2
      },
      {
        text: "Sofia queria agradecer seu melhor amigo por ajudar em um momento dif√≠cil. Ent√£o, ela preparou uma surpresa especial: fez um desenho colorido e escreveu um cart√£o com palavras carinhosas para mostrar o quanto ele era importante para ela.",
        image: "h9_sofia_amigo.png",
        question: "Ap√≥s a leitura do texto, podemos afirmar que:",
        options: [
          "Sofia entregou um desenho e um cart√£o pois est√° apaixonada.",
          "Sofia teve um gesto de gratid√£o com o seu amigo.",
          "Sofia queria ajudar um amigo que passava por um momento dif√≠cil."
        ],
        answer: 1
      },
      {
        text: "Lucas adorava ler livros de aventuras. Depois de terminar a leitura de um livro que gostou muito, ele contou para a turma as partes que achou mais emocionantes e o que aprendeu com a hist√≥ria, deixando todos curiosos para ler tamb√©m.",
        image: "h10_lucas_livro.png",
        question: "A atitude de Lucas fez com que:",
        options: [
          "A turma parasse de prestar aten√ß√£o na aula.",
          "Quisessem ler o livro na sala de aula.",
          "Os seus colegas despertassem a vontade de ler o livro."
        ],
        answer: 2
      }
    ];

    const startScreen = document.getElementById('start-screen');
    const gameScreen = document.getElementById('game');
    const endScreen = document.getElementById('end-screen');
    const lostContainer = document.getElementById('lost-container');
    const playerNameInput = document.getElementById('player-name');
    const startBtn = document.getElementById('start-btn');
    const displayName = document.getElementById('display-name');
    const scoreSpan = document.getElementById('score');
    const livesSpan = document.getElementById('lives');
    const storyImage = document.getElementById('story-image');
    const storyText = document.getElementById('story-text');
    const questionEl = document.getElementById('question');
    const optionsDiv = document.getElementById('options');
    const feedbackDiv = document.getElementById('feedback');
    const nextBtn = document.getElementById('next-btn');
    const finalPlayerName = document.getElementById('final-player-name');
    const finalScore = document.getElementById('final-score');

    let currentStoryIndex = 0;
    let score = 0;
    let lives = 3;
    let playerName = '';
    let scoreHistory = [0]; 
    let reportData = [];

    function startGame() {
      playerName = playerNameInput.value.trim();
      if (playerName === '') {
        alert('Por favor, digite seu nome para come√ßar!');
        return;
      }
      startScreen.style.display = 'none';
      endScreen.style.display = 'none';
      lostContainer.style.display = 'none';
      gameScreen.style.display = 'block';

      displayName.textContent = playerName;
      score = 0;
      lives = 3;
      currentStoryIndex = 0;
      scoreHistory = [0];
      reportData = [];
      updateScoreLives();
      loadStory();
    }

    function updateScoreLives() {
      scoreSpan.textContent = score;
      livesSpan.textContent = lives;
    }

    function loadStory() {
      feedbackDiv.textContent = '';
      nextBtn.style.display = 'none';
      optionsDiv.innerHTML = '';

      if (currentStoryIndex >= stories.length) {
        endGame();
        return;
      }

      const story = stories[currentStoryIndex];
      storyImage.src = story.image;
      storyText.textContent = story.text;
      questionEl.textContent = story.question;

      story.options.forEach((option, index) => {
        const btn = document.createElement('button');
        btn.textContent = option;
        btn.onclick = () => checkAnswer(index);
        optionsDiv.appendChild(btn);
      });
    }

    function checkAnswer(selectedIndex) {
      [...optionsDiv.children].forEach(btn => btn.disabled = true);

      const story = stories[currentStoryIndex];
      const isCorrect = (selectedIndex === story.answer);

      if (isCorrect) {
        score += 10;
        feedbackDiv.textContent = 'Resposta correta! üéâ';
        feedbackDiv.className = 'feedback correct';
      } else {
        lives--;
        feedbackDiv.textContent = 'Resposta errada! üò¢';
        feedbackDiv.className = 'feedback wrong';
      }

      // Salva dados para o gr√°fico e PDF
      reportData.push({
        pergunta: story.question,
        escolhida: story.options[selectedIndex],
        status: isCorrect ? "Acertou" : "Errou"
      });
      scoreHistory.push(score);

      updateScoreLives();

      if (lives <= 0) {
        setTimeout(loseGame, 800);
        return;
      }
      nextBtn.style.display = 'inline-block';
    }

    function renderChart() {
      const ctx = document.getElementById('scoreChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: scoreHistory.map((_, i) => `Q${i}`),
          datasets: [{
            label: 'Evolu√ß√£o da Pontua√ß√£o',
            data: scoreHistory,
            borderColor: '#8b4513',
            backgroundColor: 'rgba(139, 69, 19, 0.2)',
            borderWidth: 3,
            tension: 0.3,
            fill: true
          }]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });
    }

    window.generatePDF = function() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(18);
      doc.setTextColor(139, 69, 19);
      doc.text("BOLETIM DE DESEMPENHO - INTERPRETA√á√ÉO", 105, 20, { align: "center" });
      doc.setFontSize(12);
      doc.setTextColor(0);
      doc.text(`Jogador: ${playerName}`, 14, 35);
      doc.text(`Pontua√ß√£o Total: ${score}`, 14, 42);

      const rows = reportData.map(item => [item.pergunta, item.escolhida, item.status]);
      doc.autoTable({
        startY: 50,
        head: [['Quest√£o', 'Sua Resposta', 'Resultado']],
        body: rows,
        headStyles: { fillColor: [139, 69, 19] },
        didParseCell: (data) => {
          if (data.column.index === 2 && data.cell.section === 'body') {
            data.cell.styles.textColor = data.cell.raw === 'Acertou' ? [40, 167, 69] : [220, 53, 69];
          }
        }
      });
      doc.save(`Boletim_Interpretacao_${playerName}.pdf`);
    }

    function endGame() {
      gameScreen.style.display = 'none';
      endScreen.style.display = 'block';
      finalPlayerName.textContent = playerName;
      finalScore.textContent = score;
      renderChart();
    }

    function loseGame() {
      gameScreen.style.display = 'none';
      lostContainer.style.display = 'block';
    }

    function restartGame() {
      startScreen.style.display = 'block';
      lostContainer.style.display = 'none';
      playerNameInput.value = '';
    }

    function nextStory() {
      currentStoryIndex++;
      loadStory();
    }

    function goToNextModule() {
      window.location.href = "index.html";
    }

    startBtn.addEventListener('click', startGame);
    nextBtn.addEventListener('click', nextStory);
  </script>
</body>
</html>