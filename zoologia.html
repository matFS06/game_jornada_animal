<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Classificação do Reino Animal</title>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Comic Sans MS', sans-serif;
      background-color: #f1f8ff;
      padding: 20px;
      text-align: center;
      background-image: url('animais.png'); 
      background-size: cover;
      background-position: center;
      height: 100vh;
    }
    .container {
      max-width: 600px;
      margin: 30px auto;
      background-color: white;
      padding: 20px;
      border-radius: 15px;
      border: 5px solid #007bff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .animal {
      font-size: 24px;
      font-weight: bold;
      background-color: #ffeb3b;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      display: inline-block;
    }
    .question {
      font-size: 22px;
      margin-bottom: 20px;
    }
    .btn {
      font-size: 18px;
      background-color: #4caf50;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 10px;
      cursor: pointer;
      border-radius: 5px;
    }
    .btn:hover {
      background-color: #45a049;
    }
    .scoreboard {
      font-size: 20px;
      padding: 10px;
      background-color: white;
      border-radius: 10px;
      border: 2px solid #007bff;
      display: inline-block;
      max-width: 500px;
      margin: 20px auto;
    }
    .answer-buttons {
      margin-top: 20px;
    }
    .answer-button {
      font-size: 18px;
      background-color: #007bff;
      color: white;
      border-radius: 5px;
      padding: 10px 20px;
      margin: 10px;
      cursor: pointer;
      border: none;
    }
    .answer-button:hover {
      background-color: #0056b3;
    }
    .message {
      margin-top: 20px;
      font-size: 20px;
      padding: 10px;
      border-radius: 10px;
      display: inline-block;
    }
    .correct {
      background-color: #4caf50;
      color: white;
    }
    .incorrect {
      background-color: #f44336;
      color: white;
    }
    #explanation-container {
      display: none;
      margin-top: 20px;
      padding: 15px;
      border: 2px solid #007bff;
      border-radius: 10px;
      background-color: #ffeb3b;
    }
    #explanation-container img {
      width: 100%;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    #explanation-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    #start-screen {
      display: block;
    }
    #quiz-container, #scoreboard, #restart-container, #lost-container {
      display: none;
    }
    #player-name {
      font-size: 18px;
      padding: 8px;
      width: 80%;
      max-width: 300px;
      margin-bottom: 20px;
    }
    #restart-container {
      margin-top: 100px;
    }
    #lost-container {
      margin-top: 100px;
    }
    #chart-wrapper {
      margin: 20px 0;
      padding: 10px;
      background: #fff;
      border: 2px solid #2e7d32;
      border-radius: 10px;
    }
    .btn-boletim {
      background-color: #2e7d32 !important;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div id="start-screen" class="container">
    <h2>Bem-vindo ao Módulo de Zoologia</h2>
    <img src="logo_zoologia.png" alt="Logo" style="max-width: 250px; margin-bottom: 20px; border-radius: 10%;">
    <br>
    <input type="text" id="player-name" placeholder="Digite seu nome">
    <br>
    <button id="start-button" class="btn" onclick="startGame()">Iniciar</button>
  </div>

  <div id="scoreboard" class="scoreboard">
    <span id="player-display"></span>
    <span id="score">Pontos: 0</span> | <span id="lives">Vidas: 5</span>
    <span style="font-size: 24px; margin-left: 10px;">❤️</span>
  </div>

  <div id="quiz-container" class="container">
    <h2 class="question">Vamos aprender sobre o animal!</h2>
    <div id="animal" class="animal"></div>
    <div id="question-container" class="question"></div>
    
    <div class="answer-buttons">
      <button id="sim-button" class="answer-button" onclick="checkAnswer('sim')">Sim</button>
      <button id="nao-button" class="answer-button" onclick="checkAnswer('não')">Não</button>
    </div>
  
    <button id="next-question-button" class="btn" onclick="nextQuestion()" disabled>Próxima Pergunta</button>
  
    <div id="message-container" class="message"></div>
    
    <div id="explanation-container">
      <div id="explanation-title"></div>
      <img id="explanation-img" src="" alt="Imagem do Animal">
      <p id="explanation-text"></p>
      <button id="continue-button" class="btn" onclick="nextAnimal()">Continuar</button>
    </div>
  </div>

  <div id="restart-container" class="container">
    <img src="troféu.png" alt="Troféu" style="max-width: 150px; margin-bottom: 20px; border-radius: 50%;"/>
    <h2>Parabéns! Você completou todas as perguntas!</h2>
    
    <div id="chart-wrapper">
      <canvas id="meuGrafico"></canvas>
    </div>

    <button class="btn btn-boletim" onclick="gerarBoletim()">Baixar Boletim (em PDF)</button>
    <br>
    <button class="btn" onclick="restartGame()">Jogar Novamente</button>
    <button class="btn" onclick="goToNextModule()">Próximo Módulo</button>
  </div>

  <div id="lost-container" class="container">
    <img src="gameover.png" alt="Game Over" style="max-width: 200px; margin-bottom: 20px; border-radius: 50%;"/>
    <h2>Você perdeu! Que tal tentar novamente?</h2>
    <button class="btn" onclick="restartGame()">Tentar Novamente</button>
  </div>

  <script>
    let score = 0;
    let lives = 5;
    let playerName = "";
    let historicoPontos = [0];
    let dadosRespostas = [];

    let animals = [
      {
        name: "Leão",
        questions: [
          { question: "O Leão é vertebrado?", correctAnswer: "sim" },
          { question: "O habitat natural do Leão é a Savana?", correctAnswer: "sim" },
          { question: "O Leão é um mamífero?", correctAnswer: "sim" }
        ],
        explanation: "O leão é um mamífero pertencente à ordem Carnivora e família Felidae, sendo conhecido como “rei das selvas”. Ele se alimenta de outros animais, como gnus e zebras, e vive em grupos, que apresentam divisões bem marcadas. Segundo maior felino do mundo, o leão perde em tamanho apenas para o tigre. \n\nOs leões apresentam de 1,37 a 2 m de tamanho (corpo e cabeça), e sua cauda pode atingir até 100 cm de comprimento. \n\nOs leões-africanos são encontrados vivendo em planícies ou savanas, habitando, atualmente, o leste e sul da África. Os leões apresentam uma pelagem amarela dourada, a qual é importante para garantir a camuflagem em meio à vegetação da savana.",
        explanationImage: "leão.png"
      },
      {
        name: "Cobra",
        questions: [
          { question: "Todas as cobras são venenosas?", correctAnswer: "não" },
          { question: "A Cobra vive no mar?", correctAnswer: "não" },
          { question: "A Cobra é um réptil?", correctAnswer: "sim" }
        ],
        explanation: "Cobra é o nome dado a répteis rastejantes, de corpo alongado e sem patas. Elas também são chamadas de “serpentes”.\n\nExistem, somente no Brasil, pelo menos 370 espécies de serpentes, de variados tamanhos, formas e cores.\n\nAo contrário do que muita gente pensa, são poucas as espécies de serpentes capazes de causar danos aos seres humanos. Dentre elas, as que mais despertam medo são as peçonhentas.\n\nAnimais peçonhentos são aqueles que produzem veneno muito concentrado e possuem, em seu corpo, uma estrutura capaz de inocular (“injetar”) essa substância: a peçonha. No caso das serpentes peçonhentas, elas possuem dentes com modificações que permitem com que isso seja feito.",
        explanationImage: "cobra.png"
      },
      {
        name: "Borboleta",
        questions: [
          { question: "A Borboleta é um inseto?", correctAnswer: "sim" },
          { question: "A Borboleta é vertebrada?", correctAnswer: "não" },
          { question: "A Borboleta vive em florestas?", correctAnswer: "sim" }
        ],
        explanation: "Borboletas são artrópodes pertencentes à Classe Insecta. Assim, apresentam corpo dividido em cabeça, tórax e abdome; um par de antenas, três pares de patas, e também asas, estas encontradas somente nesta classe, embora nem todos os seus representantes as possuam. \n\nExistem cerca de 20 mil espécies de borboletas, encontradas em todo o mundo, com exceção das regiões glaciais. No Brasil, há pelo menos 3.100 espécies diferentes desses insetos. Diferentemente das mariposas, são animais diurnos.",
        explanationImage: "borboleta.png"
      },
      {
        name: "Elefante",
        questions: [
          { question: "O Elefante é um mamífero?", correctAnswer: "sim" },
          { question: "O Elefante é encontrado em pântanos?", correctAnswer: "não" },
          { question: "O Elefante é herbívoro?", correctAnswer: "sim" }
        ],
        explanation: "Elefantes são animais mamíferos que se destacam pelo seu grande porte, sendo considerados os maiores vertebrados terrestres existentes no mundo na atualidade. Algumas características que chamam a atenção são suas longas presas e uma tromba comprida.\n\nEsses são animais herbívoros que, para terem todas as suas necessidades metabólicas supridas, precisam ingerir vários quilos de alimento todos os dias. Atualmente, os elefantes estão ameaçados de extinção por causa da perda/fragmentação de seu habitat e pela caça.\n\nOs elefantes podem ser encontrados na África e na Ásia, ocupando diferentes habitats de acordo com a espécie analisada.",
        explanationImage: "elefante.png"
      },
      {
        name: "Lesma",
        questions: [
          { question: "A Lesma pode transmitir doenças?", correctAnswer: "sim" },
          { question: "A Lesma é vertebrada?", correctAnswer: "não" },
          { question: "A Lesma se desloca usando muco?", correctAnswer: "sim" }
        ],
        explanation: "As lesmas são moluscos gastrópodes que andam sobre o abdômen e possuem respiração cutânea. Distinguem-se dos caracóis pela inexistência de concha externa proeminente.\n\nClima frio, chuva e neblina são ideais para elas, pois em climas secos e quentes podem secar.\n\nAlém de causarem danos à agricultura, podem ser prejudiciais à saúde de humanos e animais.",
        explanationImage: "lesma.png"
      },
      {
        name: "Camarão",
        questions: [
          { question: "O Camarão é um crustáceo?", correctAnswer: "sim" },
          { question: "O Camarão vive em terra?", correctAnswer: "não" },
          { question: "O Camarão é um animal aquático?", correctAnswer: "sim" }
        ],
        explanation: "Os camarões são artrópodes da ordem dos decápodes, podendo ser marinhos ou de água doce. Possuem corpo alongado, exoesqueleto fino e flexível.\n\nO camarão nada para trás flexionando rapidamente o abdômen e a cauda. Sua alimentação consiste principalmente de pequenas plantas e animais, embora alguns camarões se alimentem de carniça. \n\nA fêmea do camarão pode botar de 1.500 a 14.000 ovos, que ficam presos às pernas nadadoras. As larvas nadadoras passam por cinco estágios de desenvolvimento antes de se tornarem juvenis .",
        explanationImage: "camarão.png"
      },
      {
        name: "Salamandra",
        questions: [
          { question: "A salamandra é um anfíbio?", correctAnswer: "sim" },
          { question: "As salamandras possuem escamas?", correctAnswer: "não" },
          { question: "As salamandras possuem asas?", correctAnswer: "não" }
        ],
        explanation: "As salamandras são anfíbios do grupo dos urodelos de corpo alongado, com cauda e, na maioria das espécies, quatro membros. Embora a maioria seja terrestre, algumas vivem totalmente na água.\n\nExistem cerca de 550 espécies, principalmente no hemisfério Norte. No Brasil, são encontradas cinco espécies, todas na região Amazônica. \n\nEsses animais muitas vezes são confundidos, por leigos, com lagartos, entretanto, diferentemente dos répteis, as salamandras possuem uma pele fina e sem escamas.\n\nAs salamandras variam muito em tamanho. Enquanto as salamandras sul-americanas podem medir entre 3 a 12 centímetros, as salamandras encontradas no Japão e na China podem apresentar mais de um metro de comprimento.",
        explanationImage: "salamandra.png"
      },
      {
        name: "Avestruz",
        questions: [
          { question: "A avestruz é uma ave?", correctAnswer: "sim" },
          { question: "A avestruz é a maior ave do mundo?", correctAnswer: "sim" },
          { question: "A avestruz é capaz de voar?", correctAnswer: "não" }
        ],
        explanation: "A avestruz é a maior ave do planeta, podendo atingir três metros de altura. Apesar de seu tamanho, é incapaz de voar, mas compensa com alta velocidade na corrida, chegando a 70 km/h.\n\nAs pernas fortes desse animal, além de ajudar na corrida, auxiliam na defesa contra predadores. \n\nAo se sentirem ameaçados, esses animais podem usá-las para deferir golpes contra seus adversários.",
        explanationImage: "avestruz.png"
      }
    ];
    
    let currentAnimalIndex = 0;
    let currentQuestionIndex = 0;
    
    function startGame() {
      playerName = document.getElementById("player-name").value.trim();
      if (!playerName) { alert("Por favor, digite seu nome!"); return; }
      document.getElementById("player-display").innerText = "Jogador: " + playerName + " | ";
      document.getElementById("start-screen").style.display = "none";
      document.getElementById("scoreboard").style.display = "block";
      document.getElementById("quiz-container").style.display = "block";
      generateRound();
    }

    function updateScoreboard() {
      document.getElementById("score").innerText = "Pontos: " + score;
      document.getElementById("lives").innerText = "Vidas: " + lives;
    }

    function clearMessage() {
      const mc = document.getElementById("message-container");
      mc.innerText = "";
      mc.classList.remove("correct", "incorrect");
    }

    function showMessage(message, isCorrect) {
      const mc = document.getElementById("message-container");
      mc.innerText = message;
      mc.classList.remove("correct", "incorrect");
      if (isCorrect) mc.classList.add("correct"); else mc.classList.add("incorrect");
    }

    function checkAnswer(answer) {
      document.getElementById("sim-button").disabled = true;
      document.getElementById("nao-button").disabled = true;
      const currentAnimal = animals[currentAnimalIndex];
      const currentQuestion = currentAnimal.questions[currentQuestionIndex];
      const acertou = (answer === currentQuestion.correctAnswer);

      if (acertou) {
        score += 10;
        showMessage("Muito bem! Resposta correta.", true);
      } else {
        lives -= 1;
        showMessage("Ops! Resposta incorreta.", false);
        if (lives === 0) {
          showLostScreen();
          return;
        }
      }
      
      historicoPontos.push(score);
      dadosRespostas.push({
        animal: currentAnimal.name,
        pergunta: currentQuestion.question,
        resultado: acertou ? "Correto" : "Errado"
      });

      updateScoreboard();
      document.getElementById("next-question-button").disabled = false;
    }

    function nextQuestion() {
      clearMessage();
      document.getElementById("next-question-button").disabled = true;
      document.getElementById("sim-button").disabled = false;
      document.getElementById("nao-button").disabled = false;
      const currentAnimal = animals[currentAnimalIndex];
      currentQuestionIndex++;

      if (currentQuestionIndex >= currentAnimal.questions.length) {
        if (currentAnimal.explanation) { showExplanation(); return; }
        currentAnimalIndex++;
        currentQuestionIndex = 0;
      }
      if (currentAnimalIndex >= animals.length) { showRestartScreen(); return; }
      generateRound();
    }

    function generateRound() {
      document.getElementById("explanation-container").style.display = "none";
      document.getElementById("animal").style.display = "block";
      document.getElementById("question-container").style.display = "block";
      document.querySelector(".answer-buttons").style.display = "block";
      document.getElementById("next-question-button").style.display = "block";
      const animal = animals[currentAnimalIndex];
      document.getElementById("animal").innerText = animal.name;
      document.getElementById("question-container").innerText = animal.questions[currentQuestionIndex].question;
    }

    function showExplanation() {
      document.getElementById("animal").style.display = "none";
      document.getElementById("question-container").style.display = "none";
      document.querySelector(".answer-buttons").style.display = "none";
      document.getElementById("next-question-button").style.display = "none";
      let animal = animals[currentAnimalIndex];
      document.getElementById("explanation-title").innerText = animal.name;
      document.getElementById("explanation-img").src = animal.explanationImage;
      document.getElementById("explanation-text").innerText = animal.explanation;
      document.getElementById("explanation-container").style.display = "block";
    }

    function nextAnimal() {
      document.getElementById("explanation-container").style.display = "none";
      currentAnimalIndex++;
      currentQuestionIndex = 0;
      if (currentAnimalIndex >= animals.length) { showRestartScreen(); return; }
      generateRound();
    }

    function showLostScreen() {
      document.getElementById("quiz-container").style.display = "none";
      document.getElementById("scoreboard").style.display = "none";
      document.getElementById("lost-container").style.display = "block";
    }

    function showRestartScreen() {
      document.getElementById("quiz-container").style.display = "none";
      document.getElementById("scoreboard").style.display = "none";
      document.getElementById("restart-container").style.display = "block";
      desenharGrafico();
    }

    function desenharGrafico() {
      const ctx = document.getElementById('meuGrafico').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: historicoPontos.map((_, i) => i),
          datasets: [{
            label: 'Sua Pontuação',
            data: historicoPontos,
            borderColor: '#2e7d32',
            backgroundColor: 'rgba(46, 125, 50, 0.2)',
            borderWidth: 3,
            fill: true,
            tension: 0.3
          }]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });
    }

    // FUNÇÃO DO BOLETIM PDF COM CORES NO GABARITO
    function gerarBoletim() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.setFontSize(22);
      doc.setTextColor(46, 125, 50); 
      doc.text("BOLETIM DE ZOOLOGIA", 105, 20, { align: "center" });
      
      doc.setFontSize(14);
      doc.setTextColor(0, 0, 0);
      doc.text(`Jogador: ${playerName}`, 20, 35);
      doc.text(`Pontuação Final: ${score} pontos`, 20, 45);

      const tableData = dadosRespostas.map(d => [d.animal, d.pergunta, d.resultado]);
      
      doc.autoTable({
        startY: 55,
        head: [['Animal', 'Pergunta', 'Resultado']],
        body: tableData,
        headStyles: { fillColor: [46, 125, 50] },
        didParseCell: function(data) {
          // Verifica se é a coluna de Resultado (índice 2) e não é o cabeçalho
          if (data.column.index === 2 && data.section === 'body') {
            const txt = data.cell.raw;
            if (txt === "Correto") {
              data.cell.styles.textColor = [0, 128, 0]; // Verde
            } else if (txt === "Errado") {
              data.cell.styles.textColor = [255, 0, 0]; // Vermelho
            }
          }
        }
      });

      doc.save(`Boletim_${playerName}_Zoologia.pdf`);
    }

    function restartGame() { location.reload(); }
    function goToNextModule() { window.location.href = "botanica.html"; }
  </script>
</body>
</html>